{
  "meta": {
    "name": "cusping_maneuver_pid_xcmg_v2",
    "version": 2,
    "description": "XCMG XDE360 (220-ton) - Cusping maneuver: forward, turn, stop, reverse",
    "control_mode": "velocity_pid"
  },
  "timing": {
    "dt_s": 0.01,
    "duration_s": 60.0,
    "log_hz": 10.0,
    "real_time_mode": true
  },
  "pid_config": {
    "target_velocity_mps": 2.78,
    "kp": 15000.0,
    "ki": 800.0,
    "kd": 3000.0,
    "max_torque_nm": 250000.0,
    "min_torque_nm": -145000.0,
    "integral_limit": 5000.0
  },
  "defaults": {
    "system_enable": true,
    "mode": 0,
    "drive_torque_cmd_nm": 0.0,
    "brake_cmd_pct": 0.0,
    "steer_cmd_deg": 0.0
  },
  "segments": [
    {
      "t0": 0.0,
      "t1": 15.0,
      "steer_cmd_deg": 0.0,
      "target_velocity_mps": 2.78,
      "comment": "Straight forward at 10 kph (2.78 m/s)"
    },
    {
      "t0": 15.0,
      "t1": 25.0,
      "steer_cmd_deg": 15.0,
      "target_velocity_mps": 2.78,
      "comment": "Right turn at 10 kph"
    },
    {
      "t0": 25.0,
      "t1": 32.0,
      "steer_cmd_deg": 15.0,
      "target_velocity_mps": 0.0,
      "comment": "Decelerate to stop while maintaining turn"
    },
    {
      "t0": 32.0,
      "t1": 35.0,
      "steer_cmd_deg": 15.0,
      "target_velocity_mps": 0.0,
      "comment": "Hold stopped position"
    },
    {
      "t0": 35.0,
      "t1": 50.0,
      "steer_cmd_deg": 15.0,
      "target_velocity_mps": -2.0,
      "comment": "Reverse at -2 m/s (~7 kph) while maintaining turn angle"
    },
    {
      "t0": 50.0,
      "t1": 60.0,
      "steer_cmd_deg": 0.0,
      "target_velocity_mps": 0.0,
      "comment": "Final stop and straighten steering"
    }
  ],
  "tuning_notes": {
    "description": "PID tuning for XCMG XDE360 220-ton electric mining truck - Cusping maneuver",
    "vehicle_params": {
      "mass_kg": 220000,
      "max_motor_torque_nm": 145000,
      "max_brake_force_n": 180000,
      "wheel_radius_m": 1.95,
      "gear_ratio": 28.0
    },
    "gains_rationale": {
      "kp": "15000 - Strong proportional response for heavy truck",
      "ki": "800 - Handle sustained drag/rolling resistance",
      "kd": "3000 - Critical for damping 220-ton inertia during velocity changes",
      "integral_limit": "5000 - Prevent excessive windup during stop/reverse transitions"
    },
    "brake_conversion_required": {
      "condition": "When PID outputs negative torque",
      "formula": "brake_pct = abs(torque_nm) / max_brake_torque_equivalent * 100",
      "max_brake_torque_equivalent": "brake_force_n * wheel_radius_m / gear_ratio = 180000 * 1.95 / 28 = 12536 Nm",
      "example": "If PID = -10000 Nm, brake = 10000/12536*100 = 79.8%",
      "critical": "Must set drive_torque_cmd_nm = 0 when braking!"
    },
    "cusping_maneuver_notes": {
      "forward_phase": "Accelerate to 10 kph, then execute right turn",
      "stop_phase": "Gradually decelerate to complete stop - requires PID target = 0",
      "reverse_phase": "Reverse at -2 m/s while maintaining turn angle",
      "implementation_note": "Per-segment target_velocity_mps overrides global PID target_velocity_mps if supported"
    }
  }
}
